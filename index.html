<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Queue Theory Calculator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: #000;
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .content {
            padding: 30px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .tab {
            flex: 1;
            min-width: 150px;
            padding: 15px 20px;
            background: #f0f0f0;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 600;
            transition: all 0.3s;
        }

        .tab:hover {
            background: #e0e0e0;
            transform: translateY(-2px);
        }

        .tab.active {
            background: #000;
            color: white;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .model-info {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            border-left: 4px solid #000;
        }

        .model-info h3 {
            color: #000;
            margin-bottom: 10px;
        }

        .input-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        .input-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .input-group input {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s;
        }

        .input-group input:focus {
            outline: none;
            border-color: #000;
            box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.1);
        }

        .calculate-btn {
            width: 100%;
            padding: 15px;
            background: #000;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 30px;
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            background: #333;
        }

        .calculate-btn:active {
            transform: translateY(0);
        }

        .error {
            background: #fee;
            color: #c33;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #c33;
            display: none;
        }

        .error.show {
            display: block;
        }

        .results {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .result-card {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            transition: all 0.3s;
            border: 2px solid #e0e0e0;
        }

        .result-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border-color: #000;
        }

        .result-card .label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .result-card .value {
            font-size: 2em;
            font-weight: 700;
            color: #000;
        }

        .result-card .description {
            font-size: 0.8em;
            color: #888;
            margin-top: 5px;
        }

        .formula-section {
            background: #f0f0f0;
            padding: 20px;
            border-radius: 10px;
            margin-top: 30px;
        }

        .formula-section h3 {
            color: #333;
            margin-bottom: 15px;
        }

        .formula {
            background: white;
            padding: 10px 15px;
            border-radius: 5px;
            margin: 8px 0;
            font-family: 'Courier New', monospace;
            border-left: 3px solid #000;
        }

        .hidden {
            display: none !important;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .tabs {
                flex-direction: column;
            }

            .results {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Queue Theory Calculator</h1>
            <p>Academic Tool for Queueing System Analysis</p>
        </div>

        <div class="content">
            <!-- Model Selection Tabs -->
            <div class="tabs">
                <button class="tab active" onclick="selectModel('DD1K1')">D/D/1/K-1</button>
                <button class="tab" onclick="selectModel('MM1')">M/M/1</button>
                <button class="tab" onclick="selectModel('MMC')">M/M/C</button>
            </div>

            <!-- Model Description -->
            <div class="model-info">
                <h3 id="modelTitle">D/D/1/K-1 - Deterministic Model</h3>
                <p id="modelDesc">Deterministic arrival and service with single server and finite capacity K-1</p>
            </div>

            <!-- Error Message -->
            <div class="error" id="errorMsg"></div>

            <!-- Input Form -->
            <form id="queueForm">
                <div class="input-section">
                    <div class="input-group">
                        <label>Arrival Rate (λ)</label>
                        <input type="number" id="lambda" step="0.01" min="0.01" required>
                    </div>

                    <div class="input-group">
                        <label>Service Rate (μ)</label>
                        <input type="number" id="mu" step="0.01" min="0.01" required>
                    </div>

                    <div class="input-group hidden" id="cGroup">
                        <label>Number of Servers (c)</label>
                        <input type="number" id="c" min="1" value="2">
                    </div>

                    <div class="input-group hidden" id="kGroup">
                        <label>System Capacity (K)</label>
                        <input type="number" id="k" min="1" value="10">
                    </div>

                    <div class="input-group hidden" id="n0Group">
                        <label>Initial Customers (n₀)</label>
                        <input type="number" id="n0" min="0" value="0">
                    </div>

                    <div class="input-group hidden" id="tGroup">
                        <label>Time (t)</label>
                        <input type="number" id="t" step="0.1" min="0" value="0">
                    </div>
                </div>

                <button type="button" class="calculate-btn" onclick="calculateMetrics()">Calculate Metrics</button>
            </form>

            <!-- Results -->
            <div class="results" id="results"></div>

            <!-- Formulas -->
            <div class="formula-section">
                <h3>Formulas Used</h3>
                <div id="formulas"></div>
            </div>
        </div>
    </div>

    <script>
        let currentModel = 'DD1K1';

        const modelData = {
            DD1K1: {
                title: 'D/D/1/K-1 - Deterministic Model',
                description: 'Deterministic arrival and service with single server and finite capacity K-1',
                formulas: [
                    'n(t) = ⎣λt⎦ - ⎣μt⎦ (bounded by [0, K-1])',
                    'ρ = λ / μ',
                    'Wq(n) = (1/μ - 1/λ)(n-1) for n < λt_i',
                    'W(n) = Wq(n) + 1/μ'
                ],
                inputs: ['lambda', 'mu', 'k', 'n0', 't']
            },
            MM1: {
                title: 'M/M/1 - Single Server Queue',
                description: 'Markovian (Poisson) arrivals and exponential service with single server',
                formulas: [
                    'ρ = λ / μ (requires λ < μ)',
                    'P₀ = 1 - ρ',
                    'L = ρ / (1 - ρ)',
                    'Lq = ρ² / (1 - ρ)',
                    'W = 1 / (μ - λ)',
                    'Wq = ρ / (μ(1 - ρ))'
                ],
                inputs: ['lambda', 'mu']
            },
            MMC: {
                title: 'M/M/C - Multiple Server Queue',
                description: 'Markovian arrivals and exponential service with multiple servers',
                formulas: [
                    'ρ = λ / (c × μ) (requires λ < c×μ)',
                    'P₀ = [Σ(r^n/n!) + (r^c/c!)×(1/(1-ρ))]⁻¹',
                    'Lq = P₀ × r^c × ρ / (c! × (1-ρ)²)',
                    'L = Lq + λ/μ',
                    'W = L / λ',
                    'Wq = Lq / λ'
                ],
                inputs: ['lambda', 'mu', 'c']
            }
        };

        function selectModel(model) {
            currentModel = model;
            
            // Update tabs
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelector(`[onclick="selectModel('${model}')"]`).classList.add('active');
            
            // Update model info
            document.getElementById('modelTitle').textContent = modelData[model].title;
            document.getElementById('modelDesc').textContent = modelData[model].description;
            
            // Update formulas
            const formulasDiv = document.getElementById('formulas');
            formulasDiv.innerHTML = modelData[model].formulas
                .map(f => `<div class="formula">${f}</div>`)
                .join('');
            
            // Show/hide inputs - First hide all
            document.getElementById('cGroup').classList.add('hidden');
            document.getElementById('kGroup').classList.add('hidden');
            document.getElementById('n0Group').classList.add('hidden');
            document.getElementById('tGroup').classList.add('hidden');
            
            // Then show only what's needed
            if (model === 'DD1K1') {
                document.getElementById('kGroup').classList.remove('hidden');
                document.getElementById('n0Group').classList.remove('hidden');
                document.getElementById('tGroup').classList.remove('hidden');
            } else if (model === 'MMC') {
                document.getElementById('cGroup').classList.remove('hidden');
            }
            
            // Clear results and errors
            document.getElementById('results').innerHTML = '';
            hideError();
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMsg');
            errorDiv.textContent = message;
            errorDiv.classList.add('show');
        }

        function hideError() {
            document.getElementById('errorMsg').classList.remove('show');
        }

        function factorial(n) {
            let result = 1;
            for (let i = 2; i <= n; i++) result *= i;
            return result;
        }

        function calculateDD1K1(lambda, mu, K, n0, t) {
            const rho = lambda / mu;
            
            // Calculate n(t)
            const netRate = lambda - mu;
            let nt = n0 + netRate * t;
            nt = Math.max(0, Math.min(K - 1, nt));
            
            // Calculate Wq and W based on λ vs μ
            let W = 'N/A', Wq = 'N/A';
            
            if (lambda > mu) {
                // System saturates
                Wq = (K - 2) / mu; // Approximation at steady state
                W = Wq + 1/mu;
            } else if (Math.abs(lambda - mu) < 0.0001) {
                // Critical case
                if (nt > 0) {
                    Wq = Math.max(0, (nt - 1) / mu);
                    W = nt / mu;
                } else {
                    Wq = 0;
                    W = 1 / mu;
                }
            } else {
                // λ < μ, system doesn't saturate
                Wq = 0;
                W = 1 / mu;
            }
            
            return {
                'n(t)': { value: nt.toFixed(3), desc: 'Customers at time t' },
                'ρ': { value: rho.toFixed(3), desc: 'Utilization' },
                'W': { value: typeof W === 'number' ? W.toFixed(3) : W, desc: 'Avg time in system' },
                'Wq': { value: typeof Wq === 'number' ? Wq.toFixed(3) : Wq, desc: 'Avg wait time' }
            };
        }

        function calculateMM1(lambda, mu) {
            const rho = lambda / mu;
            
            if (rho >= 1) {
                showError('System is unstable: λ must be less than μ for M/M/1');
                return null;
            }
            
            const P0 = 1 - rho;
            const L = rho / (1 - rho);
            const Lq = (rho * rho) / (1 - rho);
            const W = 1 / (mu - lambda);
            const Wq = rho / (mu * (1 - rho));
            
            return {
                'ρ': { value: rho.toFixed(3), desc: 'Utilization' },
                'P₀': { value: P0.toFixed(3), desc: 'Idle probability' },
                'L': { value: L.toFixed(3), desc: 'Avg in system' },
                'Lq': { value: Lq.toFixed(3), desc: 'Avg in queue' },
                'W': { value: W.toFixed(3), desc: 'Avg time in system' },
                'Wq': { value: Wq.toFixed(3), desc: 'Avg wait time' }
            };
        }

        function calculateMMC(lambda, mu, c) {
            const rho = lambda / (c * mu);
            const r = lambda / mu;
            
            if (rho >= 1) {
                showError('System is unstable: λ must be less than c×μ for M/M/C');
                return null;
            }
            
            // Calculate P0
            let sum = 0;
            for (let n = 0; n < c; n++) {
                sum += Math.pow(r, n) / factorial(n);
            }
            const tail = (Math.pow(r, c) / factorial(c)) * (1 / (1 - rho));
            const P0 = 1 / (sum + tail);
            
            // Calculate metrics
            const Lq = (P0 * Math.pow(r, c) * rho) / (factorial(c) * Math.pow(1 - rho, 2));
            const L = Lq + r;
            const W = L / lambda;
            const Wq = Lq / lambda;
            const Cidle = c - lambda / mu;
            
            return {
                'ρ': { value: rho.toFixed(3), desc: 'Utilization' },
                'P₀': { value: P0.toFixed(4), desc: 'Idle probability' },
                'L': { value: L.toFixed(3), desc: 'Avg in system' },
                'Lq': { value: Lq.toFixed(3), desc: 'Avg in queue' },
                'W': { value: W.toFixed(3), desc: 'Avg time in system' },
                'Wq': { value: Wq.toFixed(3), desc: 'Avg wait time' },
                'Idle Servers': { value: Cidle.toFixed(2), desc: 'Avg idle servers' }
            };
        }

        function displayResults(results) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '';
            
            for (const [metric, data] of Object.entries(results)) {
                const card = document.createElement('div');
                card.className = 'result-card';
                card.innerHTML = `
                    <div class="label">${metric}</div>
                    <div class="value">${data.value}</div>
                    <div class="description">${data.desc}</div>
                `;
                resultsDiv.appendChild(card);
            }
        }

        function calculateMetrics() {
            hideError();
            
            const lambda = parseFloat(document.getElementById('lambda').value);
            const mu = parseFloat(document.getElementById('mu').value);
            
            if (!lambda || !mu || lambda <= 0 || mu <= 0) {
                showError('Arrival and service rates must be positive numbers');
                return;
            }
            
            let results;
            
            switch (currentModel) {
                case 'DD1K1':
                    const K = parseInt(document.getElementById('k').value);
                    const n0 = parseInt(document.getElementById('n0').value);
                    const t = parseFloat(document.getElementById('t').value);
                    
                    if (!K || K < 1) {
                        showError('System capacity (K) must be at least 1');
                        return;
                    }
                    if (isNaN(n0) || n0 < 0) {
                        showError('Initial customers must be 0 or greater');
                        return;
                    }
                    if (isNaN(t) || t < 0) {
                        showError('Time must be 0 or greater');
                        return;
                    }
                    
                    results = calculateDD1K1(lambda, mu, K, n0, t);
                    break;
                    
                case 'MM1':
                    results = calculateMM1(lambda, mu);
                    break;
                    
                case 'MMC':
                    const c = parseInt(document.getElementById('c').value);
                    if (!c || c < 1) {
                        showError('Number of servers must be at least 1');
                        return;
                    }
                    results = calculateMMC(lambda, mu, c);
                    break;
            }
            
            if (results) {
                displayResults(results);
            }
        }

        document.getElementById('queueForm').addEventListener('submit', function(e) {
            e.preventDefault();
            calculateMetrics();
        });

        // Initialize
        selectModel('DD1K1');
    </script>
</body>
</html>
